# Food AI — концепция и общий план разработки

## 1. Назначение приложения

Food AI — это персональный дневник питания с ИИ‑помощником. Основные задачи:
- фиксировать, что пользователь ест каждый день (со фото и без);
- автоматически распознавать блюдо и его состав по фото или описанию с помощью ИИ;
- считать и визуализировать рацион по дням;
- вести личный список продуктов и шаблонов блюд, чтобы добавлять повторяющиеся блюда быстрее.

Целевая аудитория:
- люди, которые хотят отслеживать питание (ПП, ЗОЖ, похудение, набор массы);
- пользователи, которым лень вручную забивать ингредиенты и хочется «сфоткал — сохранил».

## 2. Общий сценарий работы пользователя

1. Пользователь регистрируется/логинится по email и паролю (Supabase auth).
2. Попадает на главный экран с календарём:
   - выбирает дату;
   - видит список блюд за день.
3. Добавление блюда:
   - вариант 1: через экран «Фото» — делает фото или выбирает из галереи;
   - вариант 2: через экран «Добавить без фото» — вводит название и/или описание.
4. Приложение отправляет фото/описание в ИИ (OpenRouter):
   - получает название блюда, краткое описание и список продуктов на русском;
   - предлагает пользователю отредактировать список продуктов, добавить свои.
5. При сохранении:
   - создаётся запись блюда в таблице `saved_dishes`;
   - создаются связи «блюдо — продукт» в `dish_products`;
   - фото загружается в Supabase Storage (`dish-images`) и привязывается по URL.
6. Пользователь может:
   - открыть блюдо и посмотреть подробный состав;
   - редактировать продукты и описание;
   - управлять своими продуктами и шаблонами блюд в профиле.

## 3. Архитектура и технологии

- Клиент: Flutter 3 (Material 3, Riverpod, GoRouter).
- Бэкенд: Supabase (PostgreSQL, Auth, Storage, RLS‑политики).
- ИИ: OpenRouter (`openrouter/free`) для анализа фото/текста.

Основные слои:
- `features/*` — UI‑экраны и логика презентации:
  - `home` — календарь и список блюд;
  - `camera` — добавление по фото и без фото;
  - `dish_detail` — экран конкретного блюда;
  - `profile` — профиль, списки продуктов и шаблонов;
  - `auth` — логин/регистрация.
- `services/*` — работа с Supabase и ИИ:
  - `dishes_service.dart`, `dish_products_service.dart`, `products_service.dart`;
  - `storage_service.dart` — загрузка изображений;
  - `openrouter_service.dart`, `ai_service.dart` — запросы в OpenRouter и заглушки.
- `core/*`:
  - `router` — маршрутизация и табы;
  - `theme` — темы (графитовый/чёрный/белый);
  - `auth` — слушатель авторизации;
  - `config` — env и supabaseConfig.

## 4. Ключевые сущности и таблицы

- `saved_dishes` — блюда пользователя:
  - `id`, `user_id`, `name`, `date`, `image_url`, `description`,
    `created_at`, `updated_at`.
- `products` — продукты (глобальные и пользовательские):
  - `id`, `name`, `scope ('global'|'user')`, `created_by`, `created_at`.
- `dish_products` — связь «блюдо — продукт»:
  - `id`, `dish_id`, `product_id`, `is_user_added`, `created_at`.
- `profiles` — профиль пользователя (имя, аватар).
- `dish_templates`, `dish_template_products` — шаблоны блюд и их состав.
- Storage bucket `dish-images` — файлы вида `{user_id}/{dish_id}.jpg`.

## 5. План развития приложения

### 5.1 Базовая стабильность (MVP)

- Довести до конца поток «сфоткал блюдо → ИИ → сохранил»:
  - гарантировать создание записей в `saved_dishes` и `dish_products`;
  - убедиться, что RLS‑политики позволяют пользователю работать только со своими данными.
- Убедиться, что без ИИ приложение тоже полезно:
  - полноценное добавление блюда без фото;
  - удобное ручное редактирование продуктов.

### 5.2 Улучшение UX

- Быстрая навигация по дням (свайпы, кнопки «вчера/сегодня/завтра»).
- Группировка блюд по приёмам пищи (завтрак/обед/ужин/перекус).
- Улучшенные пустые состояния:
  - подсказки, что делать, когда нет блюд или продуктов;
  - «сделать первое фото блюда».

### 5.3 Умный ИИ‑слой

- Настройка более точной модели OpenRouter, когда будет возможность:
  - калибровка промпта под нутрицию (калории, БЖУ — в будущем);
  - улучшение распознавания ингредиентов (синонимы, бренды).
- Обработка ошибок ИИ:
  - понятные сообщения пользователю;
  - fallback на заглушку при проблемах с API.

### 5.4 Профиль и персонализация

- Управление шаблонами блюд:
  - быстрое добавление блюда из шаблона;
  - редактирование шаблонов отдельно от конкретных дней.
- Управление списком продуктов:
  - отделить «глобальные» продукты от личных;
  - быстрый поиск и добавление.

### 5.5 Аналитика рациона (следующие итерации)

- Счётчики:
  - количество блюд в день;
  - простая статистика по наиболее частым продуктам/блюдам.
- В перспективе — интеграция нутриционных данных:
  - привязка продуктов к базе калорий/БЖУ;
  - отчёты за период (неделя/месяц).

## 6. Принципы разработки

- Простые, короткие сценарии:
  - минимум шагов от фото до сохранённого блюда;
  - каждое действие — предсказуемый результат.
- ИИ — помощник, не обязательный шаг:
  - пользователь всегда может вручную поправить всё, что предложил ИИ;
  - приложение не ломается, если ИИ недоступен.
- Безопасность и приватность:
  - все данные пользователя изолированы RLS‑политиками Supabase;
  - доступ только к своим блюдам, продуктам и фото.

